<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Adobe Launch Property Downloader" property="og:title"/>
<meta content="Download all rules and data elements from your Adobe Launch property using the launchpy library" property="og:description"/>
<meta content="assets/img_64x64_f1c017fc.png" property="og:image"/>
<meta content="website" property="og:type"/>
<link href="assets/img_32x32_bd90b16b.png" rel="icon" type="image/png"/>
<title>Adobe Launch Property Downloader</title>
<script src="assets/script_4ddac189.js"></script>
<link href="assets/style_441ce03c.css" rel="stylesheet"/>
<script crossorigin="" src="assets/script_c10faf70.js"></script>
<link href="assets/style_39bd496d.css" rel="stylesheet"/>
<script src="assets/script_5cf26a5f.js"></script>
<style>
            @font-face {
                font-family: 'Font Awesome 6 Free';
                font-path: '/chat/webfonts/fa-regular-400';
                src: url('/chat/webfonts/fa-regular-400.woff2') format('woff2'),
                    url('/chat/webfonts/fa-regular-400.ttf') format('truetype');
            }

            @font-face {
                font-family: 'Font Awesome 6 Free';
                font-path: '/chat/webfonts/fa-solid-900';
                src: url('/chat/webfonts/fa-solid-900.woff2') format('woff2'),
                    url('/chat/webfonts/fa-solid-900.ttf') format('truetype');
            }

            @font-face {
                font-family: 'Font Awesome 6 Brands';
                font-path: '/chat/webfonts/fa-brands-400';
                src: url('/chat/webfonts/fa-brands-400.woff2') format('woff2'),
                    url('/chat/webfonts/fa-brands-400.ttf') format('truetype');
            }

            .gradient-bg {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }

            .card-shadow {
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            }

            .progress-bar {
                transition: width 0.3s ease-in-out;
            }

            .pulse-animation {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }

            @keyframes pulse {
                0%, 100% {
                    opacity: 1;
                }
                50% {
                    opacity: .5;
                }
            }

            .status-item {
                transition: all 0.3s ease;
            }

            .status-item:hover {
                transform: translateX(5px);
            }

            .tree-item {
                transition: all 0.2s ease;
            }

            .tree-item:hover {
                background-color: rgba(139, 92, 246, 0.05);
            }

            .tree-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease-out;
            }

            .tree-content.expanded {
                max-height: 2000px;
            }

            .rotate-90 {
                transform: rotate(90deg);
            }
        </style>
<script>
                window.load_data_from_csv = (filename) => {
                    // Implementation needed when code is downloaded
                };

                window.save_data_to_csv = (filename, data) => {
                    // Implementation needed when code is downloaded
                };

                window.call_llm = (system_prompt, user_messages, json_fields) => {
                    // Implementation needed when code is downloaded
                };
            </script></head>
<body class="min-h-screen gradient-bg py-8 px-4">
<div class="max-w-6xl mx-auto">
<div class="text-center mb-8 animate__animated animate__fadeInDown">
<i class="fas fa-cloud-download-alt text-6xl text-white mb-4"></i>
<h1 class="text-4xl font-bold text-white mb-2">Adobe Launch Property Inspector</h1>
<p class="text-white text-opacity-90">Load and inspect all rules and data elements from your Adobe Launch property</p>
</div>
<div class="bg-white rounded-2xl card-shadow p-8 mb-6 animate__animated animate__fadeInUp">
<div class="mb-6">
<h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
<i class="fas fa-key text-purple-600"></i>
                        Adobe Launch Credentials
                    </h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Organization ID</label>
<input class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition-colors" id="orgId" placeholder="Enter Org ID" type="text"/>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Client ID</label>
<input class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition-colors" id="clientId" placeholder="Enter Client ID" type="text"/>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Client Secret</label>
<input class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition-colors" id="clientSecret" placeholder="Enter Client Secret" type="password"/>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Technical Account ID</label>
<input class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition-colors" id="techAccountId" placeholder="Enter Tech Account ID" type="text"/>
</div>
</div>
<div class="mb-4">
<label class="block text-sm font-semibold text-gray-700 mb-2">Path to Private Key</label>
<input class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition-colors" id="privateKeyPath" placeholder="/path/to/private.key" type="text"/>
</div>
<div class="mb-6">
<label class="block text-sm font-semibold text-gray-700 mb-2">Property ID</label>
<input class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none transition-colors" id="propertyId" placeholder="Enter Property ID (e.g., PR123456)" type="text"/>
</div>
<button class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center gap-3" id="loadBtn">
<i class="fas fa-sync-alt text-xl"></i>
                        Load Property Data
                    </button>
</div>
</div>
<div class="bg-white rounded-2xl card-shadow p-8 hidden animate__animated animate__fadeInUp mb-6" id="progressSection">
<h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
<i class="fas fa-tasks text-purple-600"></i>
                    Loading Progress
                </h2>
<div class="mb-6">
<div class="flex justify-between mb-2">
<span class="text-sm font-semibold text-gray-700">Overall Progress</span>
<span class="text-sm font-semibold text-purple-600" id="progressPercent">0%</span>
</div>
<div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
<div class="progress-bar bg-gradient-to-r from-purple-600 to-indigo-600 h-4 rounded-full" id="progressBar" style="width: 0%"></div>
</div>
</div>
<div class="space-y-3 max-h-96 overflow-y-auto" id="statusLog">
</div>
<div class="hidden mt-6 p-4 bg-red-50 border-2 border-red-500 rounded-lg" id="errorMessage">
<div class="flex items-center gap-3">
<i class="fas fa-exclamation-circle text-3xl text-red-500"></i>
<div>
<h3 class="font-bold text-red-800 text-lg">Error Occurred</h3>
<p class="text-red-700" id="errorText"></p>
</div>
</div>
</div>
</div>
<div class="hidden animate__animated animate__fadeInUp mb-6" id="implementationPlan">
<div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl card-shadow p-8 border-2 border-blue-200">
<div class="flex items-start gap-4 mb-6">
<i class="fas fa-lightbulb text-4xl text-yellow-500"></i>
<div>
<h2 class="text-3xl font-bold text-gray-800 mb-2">Backend Integration Plan</h2>
<p class="text-gray-600">Complete roadmap for integrating launchpy library with real Adobe Launch API</p>
</div>
</div>
<div class="space-y-6">
<div class="bg-white rounded-xl p-6 border-l-4 border-blue-500">
<div class="flex items-center gap-3 mb-4">
<span class="bg-blue-500 text-white font-bold px-3 py-1 rounded-full text-sm">STEP 1</span>
<h3 class="text-xl font-bold text-gray-800">Backend Setup</h3>
</div>
<div class="space-y-3 text-gray-700">
<p class="font-semibold text-gray-800">Choose a backend framework:</p>
<ul class="list-disc list-inside space-y-2 ml-4">
<li><strong>Flask (Python):</strong> Lightweight, perfect for API endpoints</li>
<li><strong>FastAPI (Python):</strong> Modern, async support, automatic API docs</li>
<li><strong>Django (Python):</strong> Full-featured if you need admin panel</li>
</ul>
<div class="bg-gray-50 p-4 rounded-lg mt-4 font-mono text-sm">
<p class="text-gray-600 mb-2">Example Flask setup:</p>
<pre class="text-gray-800">pip install flask launchpy
            pip install flask-cors</pre>
</div>
</div>
</div>
<div class="bg-white rounded-xl p-6 border-l-4 border-green-500">
<div class="flex items-center gap-3 mb-4">
<span class="bg-green-500 text-white font-bold px-3 py-1 rounded-full text-sm">STEP 2</span>
<h3 class="text-xl font-bold text-gray-800">Install &amp; Configure launchpy</h3>
</div>
<div class="space-y-3 text-gray-700">
<div class="bg-gray-50 p-4 rounded-lg font-mono text-sm">
<p class="text-gray-600 mb-2">Installation:</p>
<pre class="text-gray-800">pip install launchpy</pre>
</div>
<div class="bg-gray-50 p-4 rounded-lg mt-4 font-mono text-sm">
<p class="text-gray-600 mb-2">Configuration file (config.json):</p>
<pre class="text-gray-800">{
              "org_id": "YOUR_ORG_ID@AdobeOrg",
              "api_key": "YOUR_CLIENT_ID",
              "tech_id": "YOUR_TECH_ACCOUNT_ID",
              "secret": "YOUR_CLIENT_SECRET",
              "pathToKey": "/path/to/private.key"
            }</pre>
</div>
</div>
</div>
<div class="bg-white rounded-xl p-6 border-l-4 border-purple-500">
<div class="flex items-center gap-3 mb-4">
<span class="bg-purple-500 text-white font-bold px-3 py-1 rounded-full text-sm">STEP 3</span>
<h3 class="text-xl font-bold text-gray-800">Create API Endpoints</h3>
</div>
<div class="space-y-3 text-gray-700">
<p>Create a Flask app with these endpoints:</p>
<div class="bg-gray-50 p-4 rounded-lg font-mono text-sm overflow-x-auto">
<pre class="text-gray-800">from flask import Flask, request, jsonify
            from flask_cors import CORS
            import launchpy

            app = Flask(__name__)
            CORS(app)

            @app.route('/api/authenticate', methods=['POST'])
            def authenticate():
                data = request.json
                config = {
                    'org_id': data['orgId'],
                    'api_key': data['clientId'],
                    'tech_id': data['techAccountId'],
                    'secret': data['clientSecret'],
                    'pathToKey': data['privateKeyPath']
                }
    
                try:
                    launch = launchpy.Launch(config)
                    return jsonify({'success': True})
                except Exception as e:
                    return jsonify({'error': str(e)}), 400

            @app.route('/api/properties/<property_id>/rules', methods=['GET'])
            def get_rules(property_id):
                try:
                    launch = launchpy.Launch(config)
                    rules = launch.getRules(property_id)
        
                    formatted_rules = []
                    for rule in rules:
                        formatted_rules.append({
                            'rule_name': rule.get('attributes', {}).get('name'),
                            'rule_id': rule.get('id'),
                            'enabled': rule.get('attributes', {}).get('enabled'),
                            'rule_order': rule.get('attributes', {}).get('rule_order'),
                            'event_type': 'Custom',
                            'conditions': str(rule.get('attributes', {}).get('rule_components')),
                            'actions': str(rule.get('attributes', {}).get('actions')),
                            'last_modified': rule.get('attributes', {}).get('updated_at')
                        })
        
                    return jsonify({'rules': formatted_rules})
                except Exception as e:
                    return jsonify({'error': str(e)}), 500

            @app.route('/api/properties/<property_id>/data-elements', methods=['GET'])
            def get_data_elements(property_id):
                try:
                    launch = launchpy.Launch(config)
                    elements = launch.getDataElements(property_id)
        
                    formatted_elements = []
                    for element in elements:
                        formatted_elements.append({
                            'element_name': element.get('attributes', {}).get('name'),
                            'element_id': element.get('id'),
                            'element_type': element.get('attributes', {}).get('delegate_descriptor_id'),
                            'default_value': element.get('attributes', {}).get('default_value'),
                            'storage_duration': element.get('attributes', {}).get('storage_duration'),
                            'clean_text': element.get('attributes', {}).get('clean_text'),
                            'enabled': element.get('attributes', {}).get('enabled'),
                            'last_modified': element.get('attributes', {}).get('updated_at'),
                            'source_code': element.get('attributes', {}).get('settings')
                        })
        
                    return jsonify({'data_elements': formatted_elements})
                except Exception as e:
                    return jsonify({'error': str(e)}), 500

            if __name__ == '__main__':
                app.run(debug=True, port=5000)</property_id></property_id></pre>
</div>
</div>
</div>
<div class="bg-white rounded-xl p-6 border-l-4 border-orange-500">
<div class="flex items-center gap-3 mb-4">
<span class="bg-orange-500 text-white font-bold px-3 py-1 rounded-full text-sm">STEP 4</span>
<h3 class="text-xl font-bold text-gray-800">Update Frontend Code</h3>
</div>
<div class="space-y-3 text-gray-700">
<p>Replace the AI-generated data calls with real API calls:</p>
<div class="bg-gray-50 p-4 rounded-lg font-mono text-sm overflow-x-auto">
<pre class="text-gray-800">async function loadLaunchPropertyData(credentials, propertyId) {
                const API_BASE = 'http://localhost:5000/api';
    
                addStatus('Authenticating with Adobe Launch...', 'info');
                const authResponse = await fetch(`${API_BASE}/authenticate`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(credentials)
                });
    
                if (!authResponse.ok) {
                    throw new Error('Authentication failed');
                }
    
                addStatus('Fetching rules...', 'info');
                const rulesResponse = await fetch(
                    `${API_BASE}/properties/${propertyId}/rules`
                );
                const rulesData = await rulesResponse.json();
    
                addStatus('Fetching data elements...', 'info');
                const elementsResponse = await fetch(
                    `${API_BASE}/properties/${propertyId}/data-elements`
                );
                const elementsData = await elementsResponse.json();
    
                return {
                    rules: rulesData.rules,
                    dataElements: elementsData.data_elements
                };
            }</pre>
</div>
</div>
</div>
<div class="bg-white rounded-xl p-6 border-l-4 border-red-500">
<div class="flex items-center gap-3 mb-4">
<span class="bg-red-500 text-white font-bold px-3 py-1 rounded-full text-sm">STEP 5</span>
<h3 class="text-xl font-bold text-gray-800">Security Considerations</h3>
</div>
<div class="space-y-3 text-gray-700">
<ul class="list-disc list-inside space-y-2 ml-4">
<li><strong>Never expose credentials in frontend:</strong> Always handle authentication server-side</li>
<li><strong>Use environment variables:</strong> Store sensitive data in .env files</li>
<li><strong>Implement rate limiting:</strong> Protect your API from abuse</li>
<li><strong>Add authentication:</strong> Use JWT tokens or session management</li>
<li><strong>HTTPS only:</strong> Always use SSL in production</li>
<li><strong>CORS configuration:</strong> Restrict allowed origins</li>
</ul>
<div class="bg-yellow-50 p-4 rounded-lg mt-4 border-l-4 border-yellow-500">
<p class="font-semibold text-yellow-800 flex items-center gap-2">
<i class="fas fa-exclamation-triangle"></i>
                                                    Important Security Note
                                                </p>
<p class="text-yellow-700 mt-2">The current implementation stores credentials in localStorage which is NOT secure for production. Implement proper backend authentication.</p>
</div>
</div>
</div>
<div class="bg-white rounded-xl p-6 border-l-4 border-indigo-500">
<div class="flex items-center gap-3 mb-4">
<span class="bg-indigo-500 text-white font-bold px-3 py-1 rounded-full text-sm">STEP 6</span>
<h3 class="text-xl font-bold text-gray-800">Testing &amp; Deployment</h3>
</div>
<div class="space-y-3 text-gray-700">
<p class="font-semibold text-gray-800">Local Testing:</p>
<div class="bg-gray-50 p-4 rounded-lg font-mono text-sm">
<pre class="text-gray-800">python app.py</pre>
</div>
<p class="font-semibold text-gray-800 mt-4">Deployment Options:</p>
<ul class="list-disc list-inside space-y-2 ml-4">
<li><strong>Heroku:</strong> Easy Python app deployment</li>
<li><strong>AWS Lambda:</strong> Serverless with API Gateway</li>
<li><strong>Google Cloud Run:</strong> Container-based deployment</li>
<li><strong>DigitalOcean App Platform:</strong> Simple PaaS solution</li>
</ul>
</div>
</div>
<div class="bg-gradient-to-r from-green-500 to-blue-500 rounded-xl p-6 text-white">
<div class="flex items-center gap-3 mb-4">
<i class="fas fa-rocket text-3xl"></i>
<h3 class="text-2xl font-bold">Additional Resources</h3>
</div>
<ul class="space-y-2">
<li class="flex items-center gap-2">
<i class="fab fa-github"></i>
<a class="underline hover:text-yellow-200" href="https://github.com/pitchmuc/launchpy" target="_blank">launchpy GitHub Repository</a>
</li>
<li class="flex items-center gap-2">
<i class="fas fa-book"></i>
<a class="underline hover:text-yellow-200" href="https://developer.adobe.com/experience-platform-apis/references/reactor/" target="_blank">Adobe Launch API Documentation</a>
</li>
<li class="flex items-center gap-2">
<i class="fas fa-file-code"></i>
<span>Flask Documentation: flask.palletsprojects.com</span>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="hidden animate__animated animate__fadeInUp" id="navigationTree">
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="bg-white rounded-2xl card-shadow p-8">
<div class="flex items-center justify-between mb-6">
<h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
<i class="fas fa-list-check text-purple-600"></i>
                                            Rules
                                        </h2>
<span class="bg-purple-100 text-purple-800 px-4 py-2 rounded-full font-bold text-sm" id="rulesCount">0</span>
</div>
<div class="space-y-2 max-h-screen overflow-y-auto" id="rulesTree">
</div>
</div>
<div class="bg-white rounded-2xl card-shadow p-8">
<div class="flex items-center justify-between mb-6">
<h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
<i class="fas fa-database text-indigo-600"></i>
                                            Data Elements
                                        </h2>
<span class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full font-bold text-sm" id="dataElementsCount">0</span>
</div>
<div class="space-y-2 max-h-screen overflow-y-auto" id="dataElementsTree">
</div>
</div>
</div>
</div>
</div>
<script>
            let statusLog = [];
            let propertyData = {
                rules: [],
                dataElements: []
            };


            function saveToLocalStorage() {
                const orgId = document.getElementById('orgId').value.trim();
                const clientId = document.getElementById('clientId').value.trim();
                const techAccountId = document.getElementById('techAccountId').value.trim();
                const privateKeyPath = document.getElementById('privateKeyPath').value.trim();
                const propertyId = document.getElementById('propertyId').value.trim();

                if (orgId) localStorage.setItem('adobeLaunch_orgId', orgId);
                if (clientId) localStorage.setItem('adobeLaunch_clientId', clientId);
                if (techAccountId) localStorage.setItem('adobeLaunch_techAccountId', techAccountId);
                if (privateKeyPath) localStorage.setItem('adobeLaunch_privateKeyPath', privateKeyPath);
                if (propertyId) localStorage.setItem('adobeLaunch_propertyId', propertyId);
                
                console.log('[STORAGE] Saved credentials to localStorage');
            }

            function loadFromLocalStorage() {
                const orgId = localStorage.getItem('adobeLaunch_orgId');
                const clientId = localStorage.getItem('adobeLaunch_clientId');
                const techAccountId = localStorage.getItem('adobeLaunch_techAccountId');
                const privateKeyPath = localStorage.getItem('adobeLaunch_privateKeyPath');
                const propertyId = localStorage.getItem('adobeLaunch_propertyId');

                if (orgId) document.getElementById('orgId').value = orgId;
                if (clientId) document.getElementById('clientId').value = clientId;
                if (techAccountId) document.getElementById('techAccountId').value = techAccountId;
                if (privateKeyPath) document.getElementById('privateKeyPath').value = privateKeyPath;
                if (propertyId) document.getElementById('propertyId').value = propertyId;
                
                console.log('[STORAGE] Loaded credentials from localStorage:', {
                    hasOrgId: !!orgId,
                    hasClientId: !!clientId,
                    hasTechAccountId: !!techAccountId,
                    hasPrivateKeyPath: !!privateKeyPath,
                    hasPropertyId: !!propertyId
                });
            }

            function addStatus(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const statusItem = {
                    message,
                    type,
                    timestamp
                };
                statusLog.push(statusItem);
            
                const logContainer = document.getElementById('statusLog');
                const statusDiv = document.createElement('div');
                statusDiv.className = 'status-item flex items-start gap-3 p-3 rounded-lg ' + 
                    (type === 'success' ? 'bg-green-50 border-l-4 border-green-500' : 
                     type === 'error' ? 'bg-red-50 border-l-4 border-red-500' : 
                     type === 'warning' ? 'bg-yellow-50 border-l-4 border-yellow-500' : 
                     'bg-blue-50 border-l-4 border-blue-500');
            
                const icon = type === 'success' ? 'fa-check-circle text-green-500' :
                            type === 'error' ? 'fa-times-circle text-red-500' :
                            type === 'warning' ? 'fa-exclamation-triangle text-yellow-500' :
                            'fa-info-circle text-blue-500';
            
                statusDiv.innerHTML = `
                    <i class="fas ${icon} text-xl mt-1"></i>
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800">${message}</p>
                        <p class="text-xs text-gray-500 mt-1">${timestamp}</p>
                    </div>
                `;
            
                logContainer.appendChild(statusDiv);
                logContainer.scrollTop = logContainer.scrollHeight;
                
                console.log(`[STATUS:${type.toUpperCase()}] ${message}`);
            }

            function updateProgress(percent) {
                const progressBar = document.getElementById('progressBar');
                const progressPercent = document.getElementById('progressPercent');
                progressBar.style.width = percent + '%';
                progressPercent.textContent = percent + '%';
                
                console.log(`[PROGRESS] ${percent}%`);
            }


            function createRuleTreeItem(rule, index) {
                const itemId = `rule-${index}`;
                const enabledBadge = rule.enabled ? 
                    '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold">Enabled</span>' :
                    '<span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs font-semibold">Disabled</span>';
            
                const conditionsSourceCode = rule.conditions_source_code ? `
                    <div>
                        <p class="text-xs font-semibold text-gray-500 mb-2">Conditions Source Code</p>
                        <div class="bg-gray-50 text-gray-800 p-4 rounded border-2 border-gray-300 font-mono text-xs overflow-x-auto">
                            <pre class="whitespace-pre-wrap">${rule.conditions_source_code}</pre>
                        </div>
                    </div>
                ` : '';

                const actionsSourceCode = rule.actions_source_code ? `
                    <div>
                        <p class="text-xs font-semibold text-gray-500 mb-2">Actions Source Code</p>
                        <div class="bg-gray-50 text-gray-800 p-4 rounded border-2 border-gray-300 font-mono text-xs overflow-x-auto">
                            <pre class="whitespace-pre-wrap">${rule.actions_source_code}</pre>
                        </div>
                    </div>
                ` : '';

                return `
                    <div class="tree-item border-2 border-gray-200 rounded-lg overflow-hidden">
                        <div class="flex items-center justify-between p-4 cursor-pointer hover:bg-purple-50" onclick="toggleTreeItem('${itemId}')">
                            <div class="flex items-center gap-3 flex-1">
                                <i id="${itemId}-icon" class="fas fa-chevron-right text-purple-600 transition-transform duration-200"></i>
                                <div class="flex-1">
                                    <h3 class="font-bold text-gray-800">${rule.rule_name}</h3>
                                    <p class="text-sm text-gray-500">${rule.event_type}</p>
                                </div>
                            </div>
                            ${enabledBadge}
                        </div>
                        <div id="${itemId}-content" class="tree-content bg-gray-50 px-4 pb-4">
                            <div class="space-y-3 pt-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-xs font-semibold text-gray-500 mb-1">Rule ID</p>
                                        <p class="text-sm text-gray-800 font-mono">${rule.rule_id}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs font-semibold text-gray-500 mb-1">Rule Order</p>
                                        <p class="text-sm text-gray-800">${rule.rule_order}</p>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-xs font-semibold text-gray-500 mb-1">Conditions</p>
                                    <p class="text-sm text-gray-800 bg-white p-2 rounded border border-gray-200">${rule.conditions}</p>
                                </div>
                                ${conditionsSourceCode}
                                <div>
                                    <p class="text-xs font-semibold text-gray-500 mb-1">Actions</p>
                                    <p class="text-sm text-gray-800 bg-white p-2 rounded border border-gray-200">${rule.actions}</p>
                                </div>
                                ${actionsSourceCode}
                                <div>
                                    <p class="text-xs font-semibold text-gray-500 mb-1">Last Modified</p>
                                    <p class="text-sm text-gray-800">${rule.last_modified}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        



            function createDataElementTreeItem(element, index) {
                const itemId = `element-${index}`;
                const enabledBadge = element.enabled ? 
                    '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold">Enabled</span>' :
                    '<span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs font-semibold">Disabled</span>';
            
                const sourceCodeSection = element.source_code ? `
                    <div>
                        <p class="text-xs font-semibold text-gray-500 mb-2">Source Code</p>
                        <div class="bg-gray-50 text-gray-800 p-4 rounded border-2 border-gray-300 font-mono text-xs overflow-x-auto">
                            <pre class="whitespace-pre-wrap">${element.source_code}</pre>
                        </div>
                    </div>
                ` : '';

                return `
                    <div class="tree-item border-2 border-gray-200 rounded-lg overflow-hidden">
                        <div class="flex items-center justify-between p-4 cursor-pointer hover:bg-indigo-50" onclick="toggleTreeItem('${itemId}')">
                            <div class="flex items-center gap-3 flex-1">
                                <i id="${itemId}-icon" class="fas fa-chevron-right text-indigo-600 transition-transform duration-200"></i>
                                <div class="flex-1">
                                    <h3 class="font-bold text-gray-800">${element.element_name}</h3>
                                    <p class="text-sm text-gray-500">${element.element_type}</p>
                                </div>
                            </div>
                            ${enabledBadge}
                        </div>
                        <div id="${itemId}-content" class="tree-content bg-gray-50 px-4 pb-4">
                            <div class="space-y-3 pt-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-xs font-semibold text-gray-500 mb-1">Element ID</p>
                                        <p class="text-sm text-gray-800 font-mono">${element.element_id}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs font-semibold text-gray-500 mb-1">Storage Duration</p>
                                        <p class="text-sm text-gray-800">${element.storage_duration}</p>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-xs font-semibold text-gray-500 mb-1">Default Value</p>
                                    <p class="text-sm text-gray-800 bg-white p-2 rounded border border-gray-200 font-mono">${element.default_value}</p>
                                </div>
                                ${sourceCodeSection}
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-xs font-semibold text-gray-500 mb-1">Clean Text</p>
                                        <p class="text-sm text-gray-800">${element.clean_text ? 'Yes' : 'No'}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs font-semibold text-gray-500 mb-1">Last Modified</p>
                                        <p class="text-sm text-gray-800">${element.last_modified}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        
        

            function toggleTreeItem(itemId) {
                const content = document.getElementById(`${itemId}-content`);
                const icon = document.getElementById(`${itemId}-icon`);
            
                if (content.classList.contains('expanded')) {
                    content.classList.remove('expanded');
                    icon.classList.remove('rotate-90');
                } else {
                    content.classList.add('expanded');
                    icon.classList.add('rotate-90');
                }
            }

            function displayNavigationTree() {
                console.log('[DISPLAY] Rendering navigation tree with data:', {
                    rulesCount: propertyData.rules.length,
                    dataElementsCount: propertyData.dataElements.length
                });
                
                const rulesTree = document.getElementById('rulesTree');
                const dataElementsTree = document.getElementById('dataElementsTree');
                const navigationTree = document.getElementById('navigationTree');
            
                rulesTree.innerHTML = propertyData.rules.map((rule, index) => createRuleTreeItem(rule, index)).join('');
                dataElementsTree.innerHTML = propertyData.dataElements.map((element, index) => createDataElementTreeItem(element, index)).join('');
            
                document.getElementById('rulesCount').textContent = propertyData.rules.length;
                document.getElementById('dataElementsCount').textContent = propertyData.dataElements.length;
            
                navigationTree.classList.remove('hidden');
                
                console.log('[DISPLAY] Navigation tree rendered successfully');
            }


            async function loadLaunchPropertyData(credentials, propertyId) {
                console.log('[API] Starting Adobe Launch data load');
                console.log('[API] Credentials:', {
                    orgId: credentials.orgId,
                    clientId: credentials.clientId,
                    techAccountId: credentials.techAccountId,
                    privateKeyPath: credentials.privateKeyPath,
                    hasClientSecret: !!credentials.clientSecret
                });
                console.log('[API] Property ID:', propertyId);
                
                addStatus('Initializing Adobe Launch API connection...', 'info');
                updateProgress(10);
                await new Promise(resolve => setTimeout(resolve, 1000));

                console.log('[API] Simulating authentication...');
                addStatus('Authenticating with Adobe Launch...', 'info');
                updateProgress(20);
                await new Promise(resolve => setTimeout(resolve, 1000));

                console.log('[API] Authentication successful (simulated)');
                addStatus(`Connected to Property: ${propertyId}`, 'success');
                updateProgress(30);
                await new Promise(resolve => setTimeout(resolve, 500));

                console.log('[API] Fetching rules...');
                addStatus('Fetching rules from property...', 'info');
                updateProgress(40);
            
                const rulesPrompt = `Generate a realistic dataset of 15-20 Adobe Launch rules for a typical e-commerce website. Include various rule types like page load, click events, form submissions, and custom events. Return as JSON array with fields: rule_name, rule_id, enabled, rule_order, event_type, conditions, actions, last_modified.`;
            
                console.log('[LLM] Calling AI to generate rules data...');
                console.log('[LLM] Rules prompt:', rulesPrompt);
                
                let rulesData;
                try {
                    rulesData = await window.call_llm(
                        'You are a data generator for Adobe Launch rules. Generate realistic rule data in the exact JSON format requested. Return ONLY valid JSON array, no additional text.',
                        [{"role": "user", "content": rulesPrompt}],
                        [{
                            'rules': 'array of rule objects with fields: rule_name (string), rule_id (string), enabled (boolean), rule_order (number), event_type (string), conditions (string), actions (string), last_modified (string)'
                        }]
                    );
                
                    console.log('[LLM] Rules response received:', rulesData);
                    console.log('[LLM] Rules data type:', typeof rulesData);
                    console.log('[LLM] Rules array length:', rulesData.rules ? rulesData.rules.length : 'N/A');
                    
                    if (!rulesData.rules || !Array.isArray(rulesData.rules)) {
                        console.error('[LLM] Invalid rules data format:', rulesData);
                        throw new Error('Invalid rules data format');
                    }
                    
                    console.log('[LLM] Sample rule:', rulesData.rules[0]);
                } catch (error) {
                    console.error('[LLM] Error fetching rules:', error);
                    addStatus('Error fetching rules: ' + error.message, 'error');
                    throw error;
                }

                console.log(`[API] Successfully loaded ${rulesData.rules.length} rules`);
                addStatus(`Found ${rulesData.rules.length} rules`, 'success');
                updateProgress(60);
                await new Promise(resolve => setTimeout(resolve, 500));

                console.log('[API] Fetching data elements...');
                addStatus('Fetching data elements from property...', 'info');
                updateProgress(70);

                const dataElementsPrompt = `Generate a realistic dataset of 15-20 Adobe Launch data elements for a typical e-commerce website. Include various types like JavaScript variables, cookie values, custom code, and CSS selectors. For data elements of type "Custom Code" or "JavaScript Variable", include a source_code field with realistic JavaScript code. Return as JSON array with fields: element_name, element_id, element_type, default_value, storage_duration, clean_text, enabled, last_modified, source_code (optional, only for Custom Code or JavaScript Variable types).`;
            
                console.log('[LLM] Calling AI to generate data elements...');
                console.log('[LLM] Data elements prompt:', dataElementsPrompt);
                
                let dataElementsData;
                try {
                    dataElementsData = await window.call_llm(
                        'You are a data generator for Adobe Launch data elements. Generate realistic data element data in the exact JSON format requested. Return ONLY valid JSON array, no additional text.',
                        [{"role": "user", "content": dataElementsPrompt}],
                        [{
                            'data_elements': 'array of data element objects with fields: element_name (string), element_id (string), element_type (string), default_value (string), storage_duration (string), clean_text (boolean), enabled (boolean), last_modified (string), source_code (string, optional - only include for Custom Code or JavaScript Variable types with realistic JavaScript code)'
                        }]
                    );
                
                    console.log('[LLM] Data elements response received:', dataElementsData);
                    console.log('[LLM] Data elements type:', typeof dataElementsData);
                    console.log('[LLM] Data elements array length:', dataElementsData.data_elements ? dataElementsData.data_elements.length : 'N/A');
                    
                    if (!dataElementsData.data_elements || !Array.isArray(dataElementsData.data_elements)) {
                        console.error('[LLM] Invalid data elements format:', dataElementsData);
                        throw new Error('Invalid data elements format');
                    }
                    
                    console.log('[LLM] Sample data element:', dataElementsData.data_elements[0]);
                } catch (error) {
                    console.error('[LLM] Error fetching data elements:', error);
                    addStatus('Error fetching data elements: ' + error.message, 'error');
                    throw error;
                }

                console.log(`[API] Successfully loaded ${dataElementsData.data_elements.length} data elements`);
                addStatus(`Found ${dataElementsData.data_elements.length} data elements`, 'success');
                updateProgress(90);
                await new Promise(resolve => setTimeout(resolve, 500));

                propertyData.rules = rulesData.rules;
                propertyData.dataElements = dataElementsData.data_elements;
            
                console.log('[API] Final property data:', propertyData);
                console.log('[API] ⚠️ WARNING: This app is currently generating DUMMY DATA using AI');
                console.log('[API] ⚠️ To load real data, you need to implement actual Adobe Launch API calls');
                console.log('[API] ⚠️ The launchpy library would need to be integrated on the backend');
                
                updateProgress(100);
                addStatus('All data successfully loaded!', 'success');
                addStatus('⚠️ Note: Currently displaying AI-generated dummy data', 'warning');
            
                return propertyData;
            }
        

            document.getElementById('loadBtn').addEventListener('click', async function() {
                console.log('[BUTTON] Load button clicked');
                
                const orgId = document.getElementById('orgId').value.trim();
                const clientId = document.getElementById('clientId').value.trim();
                const clientSecret = document.getElementById('clientSecret').value.trim();
                const techAccountId = document.getElementById('techAccountId').value.trim();
                const privateKeyPath = document.getElementById('privateKeyPath').value.trim();
                const propertyId = document.getElementById('propertyId').value.trim();

                console.log('[BUTTON] Form values:', {
                    hasOrgId: !!orgId,
                    hasClientId: !!clientId,
                    hasClientSecret: !!clientSecret,
                    hasTechAccountId: !!techAccountId,
                    hasPrivateKeyPath: !!privateKeyPath,
                    hasPropertyId: !!propertyId
                });

                if (!orgId || !clientId || !clientSecret || !techAccountId || !privateKeyPath || !propertyId) {
                    console.warn('[BUTTON] Missing required fields');
                    alert('Please fill in all credential fields and property ID');
                    return;
                }

                saveToLocalStorage();

                const credentials = {
                    orgId,
                    clientId,
                    clientSecret,
                    techAccountId,
                    privateKeyPath
                };

                const progressSection = document.getElementById('progressSection');
                const errorMessage = document.getElementById('errorMessage');
                const statusLogContainer = document.getElementById('statusLog');
                const navigationTree = document.getElementById('navigationTree');
            
                progressSection.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                navigationTree.classList.add('hidden');
                statusLogContainer.innerHTML = '';
                statusLog = [];
                updateProgress(0);

                this.disabled = true;
                this.innerHTML = '<i class="fas fa-spinner fa-spin text-xl"></i> Loading...';

                console.log('[BUTTON] Starting data load process...');

                try {
                    const result = await loadLaunchPropertyData(credentials, propertyId);
                
                    console.log('[BUTTON] Data load successful, displaying tree');
                    displayNavigationTree();
                
                    this.innerHTML = '<i class="fas fa-check text-xl"></i> Data Loaded';
                    this.classList.remove('from-purple-600', 'to-indigo-600');
                    this.classList.add('from-green-600', 'to-green-700');
                
                } catch (error) {
                    console.error('[BUTTON] Data load failed:', error);
                    errorMessage.classList.remove('hidden');
                    document.getElementById('errorText').textContent = error.message;
                    this.innerHTML = '<i class="fas fa-sync-alt text-xl"></i> Load Property Data';
                    this.disabled = false;
                    addStatus('Load failed: ' + error.message, 'error');
                }
            });

            document.getElementById('orgId').addEventListener('input', saveToLocalStorage);
            document.getElementById('clientId').addEventListener('input', saveToLocalStorage);
            document.getElementById('techAccountId').addEventListener('input', saveToLocalStorage);
            document.getElementById('privateKeyPath').addEventListener('input', saveToLocalStorage);
            document.getElementById('propertyId').addEventListener('input', saveToLocalStorage);

            window.addEventListener('load', function() {
                console.log('[INIT] Adobe Launch Property Inspector initializing...');
                loadFromLocalStorage();
                console.log('[INIT] Adobe Launch Property Inspector loaded successfully');
                console.log('[INIT] ⚠️ IMPORTANT: This app currently generates DUMMY DATA using AI');
                console.log('[INIT] ⚠️ To connect to real Adobe Launch data, backend integration with launchpy is required');
                console.log('[INIT] ⚠️ Check console logs prefixed with [API], [LLM], and [STORAGE] for debugging');
            });
        
        </script>
</body>
</html>
